(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{347:()=>{},1319:(e,a,t)=>{"use strict";t.d(a,{default:()=>n});var r=t(5155),s=t(3568);function n(){return(0,r.jsx)(s.l$,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#1f2937",color:"#fff"},success:{iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})}},2099:(e,a,t)=>{"use strict";t.d(a,{ND:()=>o});var r=t(5647);t(9509);let s="https://zvelgxclmqgohntjimyf.supabase.co",n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2ZWxneGNsbXFnb2hudGppbXlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyOTkzMDUsImV4cCI6MjA2NDg3NTMwNX0.CFdW-XH8y7hkOm7LUtqQxs36hPTRBYtha4EIeRhIXto";if(!s||!n)throw Error("Missing Supabase environment variables");let o=(0,r.UU)(s,n,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{fetch:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,{...a,signal:AbortSignal.timeout(3e4)})}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}})},2957:(e,a,t)=>{"use strict";t.d(a,{ReduxProvider:()=>T});var r=t(5155),s=t(2115),n=t(3415),o=t(4536),l=t(9519);let d=(0,o.Z0)({name:"sacco",initialState:{groups:[],currentGroup:null,loading:!1},reducers:{setGroups:(e,a)=>{e.groups=a.payload},setCurrentGroup:(e,a)=>{e.currentGroup=a.payload},setLoading:(e,a)=>{e.loading=a.payload}}}),{setGroups:i,setCurrentGroup:c,setLoading:u}=d.actions,p=d.reducer;var f=t(7316);let g=(0,o.Z0)({name:"transactions",initialState:{transactions:[],loading:!1},reducers:{setTransactions:(e,a)=>{e.transactions=a.payload},addTransaction:(e,a)=>{e.transactions.unshift(a.payload)},setLoading:(e,a)=>{e.loading=a.payload}}}),{setTransactions:y,addTransaction:h,setLoading:m}=g.actions,_=g.reducer;var w=t(9710),D=t(2099);let v=(0,o.zD)("governance/fetchProposals",async(e,a)=>{let{rejectWithValue:t}=a;try{let a=D.ND.from("governance_proposals").select("\n          *,\n          users!governance_proposals_proposed_by_fkey(first_name, last_name)\n        ").order("created_at",{ascending:!1});e&&(a=a.eq("sacco_group_id",e));let{data:t,error:r}=await a;if(r)throw r;return t.map(e=>({...e,proposer_name:e.users?"".concat(e.users.first_name," ").concat(e.users.last_name):"Unknown"}))}catch(e){return t(e.message)}}),C=(0,o.zD)("governance/createProposal",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:a,error:t}=await D.ND.from("governance_proposals").insert(e).select().single();if(t)throw t;return a}catch(e){return t(e.message)}}),S=(0,o.zD)("governance/castVote",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:a,error:t}=await D.ND.from("governance_votes").insert({...e,voting_weight:e.voting_weight||1}).select().single();if(t)throw t;let{error:r}=await D.ND.rpc("update_proposal_votes",{proposal_id:e.proposal_id});if(r)throw r;return a}catch(e){return t(e.message)}}),k=(0,o.zD)("governance/fetchUserVotes",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:e,error:a}=await D.ND.from("governance_votes").select("*").order("voted_at",{ascending:!1});if(a)throw a;return e}catch(e){return t(e.message)}}),N=(0,o.zD)("governance/fetchLoanDefaults",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:e,error:a}=await D.ND.from("loan_defaults").select("\n          *,\n          loans!loan_defaults_loan_id_fkey(\n            borrower_id,\n            amount,\n            users!loans_borrower_id_fkey(first_name, last_name)\n          )\n        ").order("flagged_at",{ascending:!1});if(a)throw a;return e.map(e=>({...e,loan:e.loans?{...e.loans,borrower_name:e.loans.users?"".concat(e.loans.users.first_name," ").concat(e.loans.users.last_name):"Unknown"}:null}))}catch(e){return t(e.message)}}),b=(0,o.zD)("governance/fetchTransactionHistory",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:e,error:a}=await D.ND.from("member_transaction_history").select("*").order("created_at",{ascending:!1});if(a)throw a;return e}catch(e){return t(e.message)}}),U=(0,o.zD)("governance/fetchAuditLog",async(e,a)=>{let{rejectWithValue:t}=a;try{let a=D.ND.from("audit_log").select("*").order("timestamp",{ascending:!1}).limit(100);(null==e?void 0:e.table_name)&&(a=a.eq("table_name",e.table_name)),(null==e?void 0:e.user_id)&&(a=a.eq("user_id",e.user_id));let{data:t,error:r}=await a;if(r)throw r;return t}catch(e){return t(e.message)}}),z=(0,o.zD)("governance/updateLoanDefaultStatus",async(e,a)=>{let{defaultId:t,status:r,notes:s}=e,{rejectWithValue:n}=a;try{let e={status:r};s&&(e.resolution_notes=s),"written_off"===r&&(e.resolved_at=new Date().toISOString());let{data:a,error:n}=await D.ND.from("loan_defaults").update(e).eq("id",t).select().single();if(n)throw n;return a}catch(e){return n(e.message)}}),I=(0,o.Z0)({name:"governance",initialState:{proposals:[],userVotes:[],loanDefaults:[],transactionHistory:[],auditLog:[],loading:!1,error:null,selectedProposal:null},reducers:{clearError:e=>{e.error=null},setSelectedProposal:(e,a)=>{e.selectedProposal=a.payload},clearSelectedProposal:e=>{e.selectedProposal=null}},extraReducers:e=>{e.addCase(v.pending,e=>{e.loading=!0,e.error=null}).addCase(v.fulfilled,(e,a)=>{e.loading=!1,e.proposals=a.payload}).addCase(v.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(C.fulfilled,(e,a)=>{e.proposals.unshift(a.payload)}).addCase(S.fulfilled,(e,a)=>{e.userVotes.unshift(a.payload)}).addCase(k.fulfilled,(e,a)=>{e.userVotes=a.payload}).addCase(N.fulfilled,(e,a)=>{e.loanDefaults=a.payload}).addCase(b.fulfilled,(e,a)=>{e.transactionHistory=a.payload}).addCase(U.fulfilled,(e,a)=>{e.auditLog=a.payload}).addCase(z.fulfilled,(e,a)=>{let t=e.loanDefaults.findIndex(e=>e.id===a.payload.id);-1!==t&&(e.loanDefaults[t]=a.payload)})}}),{clearError:x,setSelectedProposal:G,clearSelectedProposal:A}=I.actions,j=I.reducer,q=(0,o.U1)({reducer:{auth:l.Ay,sacco:p,wallet:f.Ay,transactions:_,admin:w.Ay,governance:j}});function P(e){let{children:a}=e,[t,n]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{n(!0),q.dispatch((0,l.z)())},[]),(0,r.jsx)(r.Fragment,{children:a})}function T(e){let{children:a}=e;return(0,r.jsx)(n.Kq,{store:q,children:(0,r.jsx)(P,{children:a})})}},9519:(e,a,t)=>{"use strict";t.d(a,{Ay:()=>p,DY:()=>o,Lx:()=>n,y4:()=>l,z:()=>d});var r=t(4536),s=t(2099);let n=(0,r.zD)("auth/loginUser",async(e,a)=>{let{email:t,password:r}=e,{rejectWithValue:n}=a;try{var o;let{data:e,error:a}=await s.ND.auth.signInWithPassword({email:t,password:r});if(a)throw a;let{data:n,error:l}=await s.ND.from("users").select("*").eq("id",e.user.id).single();if(l)throw l;return{user:{id:n.id,email:n.email,name:"".concat(n.first_name," ").concat(n.last_name),phone:n.phone,role:n.role,bitnobWalletId:n.bitnob_wallet_id,kycStatus:n.kyc_status,created_at:n.created_at},token:(null==(o=e.session)?void 0:o.access_token)||""}}catch(e){return n(e.message)}}),o=(0,r.zD)("auth/registerUser",async(e,a)=>{let{email:t,password:r,firstName:s,lastName:n,phone:o}=e,{rejectWithValue:l}=a;try{let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(s," ").concat(n),email:t,phone:o,password:r})}),a=await e.json();if(!e.ok)throw Error(a.message);return{user:a.user,token:a.token||""}}catch(e){return l(e.message)}}),l=(0,r.zD)("auth/logoutUser",async()=>{await s.ND.auth.signOut()}),d=(0,r.zD)("auth/checkAuthStatus",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:{session:e}}=await s.ND.auth.getSession();if(!e)throw Error("No session found");let{data:a,error:t}=await s.ND.from("users").select("*").eq("id",e.user.id).single();if(t)throw t;return{user:{id:a.id,email:a.email,name:"".concat(a.first_name," ").concat(a.last_name),phone:a.phone,role:a.role,bitnobWalletId:a.bitnob_wallet_id,kycStatus:a.kyc_status,created_at:a.created_at},token:e.access_token}}catch(e){return t(e.message)}}),i=(0,r.Z0)({name:"auth",initialState:{user:null,token:null,isAuthenticated:!1,loading:!1,error:null},reducers:{clearError:e=>{e.error=null},updateUser:(e,a)=>{e.user&&(e.user={...e.user,...a.payload})}},extraReducers:e=>{e.addCase(n.pending,e=>{e.loading=!0,e.error=null}).addCase(n.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload.user,e.token=a.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(n.rejected,(e,a)=>{e.loading=!1,e.user=null,e.token=null,e.isAuthenticated=!1,e.error=a.payload}),e.addCase(o.pending,e=>{e.loading=!0,e.error=null}).addCase(o.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload.user,e.token=a.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(o.rejected,(e,a)=>{e.loading=!1,e.user=null,e.token=null,e.isAuthenticated=!1,e.error=a.payload}),e.addCase(l.fulfilled,e=>{e.user=null,e.token=null,e.isAuthenticated=!1,e.loading=!1,e.error=null}),e.addCase(d.pending,e=>{e.loading=!0}).addCase(d.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload.user,e.token=a.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(d.rejected,e=>{e.loading=!1,e.user=null,e.token=null,e.isAuthenticated=!1})}}),{clearError:c,updateUser:u}=i.actions,p=i.reducer},9710:(e,a,t)=>{"use strict";t.d(a,{Ay:()=>_,JG:()=>d,Ym:()=>n,au:()=>c,pF:()=>l,pU:()=>i,rU:()=>u,xi:()=>o});var r=t(4536),s=t(2099);let n=(0,r.zD)("admin/fetchAllUsers",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:e,error:a}=await s.ND.from("users").select("*").order("created_at",{ascending:!1});if(a)throw a;return e}catch(e){return t(e.message)}}),o=(0,r.zD)("admin/fetchAllSaccoGroups",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:e,error:a}=await s.ND.from("sacco_groups").select("*").order("created_at",{ascending:!1});if(a)throw a;return e}catch(e){return t(e.message)}}),l=(0,r.zD)("admin/fetchAllTransactions",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:e,error:a}=await s.ND.from("transactions").select("*").order("created_at",{ascending:!1}).limit(100);if(a)throw a;return e}catch(e){return t(e.message)}}),d=(0,r.zD)("admin/fetchAdminStats",async(e,a)=>{let{rejectWithValue:t}=a;try{let{count:e}=await s.ND.from("users").select("*",{count:"exact",head:!0}),{count:a}=await s.ND.from("users").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:t}=await s.ND.from("sacco_groups").select("*",{count:"exact",head:!0}),{count:r}=await s.ND.from("sacco_groups").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:n}=await s.ND.from("transactions").select("*",{count:"exact",head:!0}),{data:o}=await s.ND.from("transactions").select("amount").eq("status","completed"),l=(null==o?void 0:o.reduce((e,a)=>e+a.amount,0))||0,{count:d}=await s.ND.from("users").select("*",{count:"exact",head:!0}).eq("kyc_status","pending");return{totalUsers:e||0,activeUsers:a||0,totalSaccoGroups:t||0,activeSaccoGroups:r||0,totalTransactions:n||0,totalVolume:l,pendingKycCount:d||0}}catch(e){return t(e.message)}}),i=(0,r.zD)("admin/updateUserStatus",async(e,a)=>{let{userId:t,updates:r}=e,{rejectWithValue:n}=a;try{let{data:e,error:a}=await s.ND.from("users").update(r).eq("id",t).select().single();if(a)throw a;return e}catch(e){return n(e.message)}}),c=(0,r.zD)("admin/updateSaccoGroupStatus",async(e,a)=>{let{groupId:t,updates:r}=e,{rejectWithValue:n}=a;try{let{data:e,error:a}=await s.ND.from("sacco_groups").update(r).eq("id",t).select().single();if(a)throw a;return e}catch(e){return n(e.message)}}),u=(0,r.zD)("admin/approveKyc",async(e,a)=>{let{userId:t,approved:r}=e,{rejectWithValue:n}=a;try{let{data:e,error:a}=await s.ND.from("users").update({kyc_status:r?"approved":"rejected"}).eq("id",t).select().single();if(a)throw a;return e}catch(e){return n(e.message)}}),p=(0,r.Z0)({name:"admin",initialState:{users:[],saccoGroups:[],transactions:[],stats:null,loading:!1,error:null,selectedUser:null,selectedSaccoGroup:null},reducers:{clearError:e=>{e.error=null},setSelectedUser:(e,a)=>{e.selectedUser=a.payload},setSelectedSaccoGroup:(e,a)=>{e.selectedSaccoGroup=a.payload},clearSelectedUser:e=>{e.selectedUser=null},clearSelectedSaccoGroup:e=>{e.selectedSaccoGroup=null}},extraReducers:e=>{e.addCase(n.pending,e=>{e.loading=!0,e.error=null}).addCase(n.fulfilled,(e,a)=>{e.loading=!1,e.users=a.payload}).addCase(n.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(o.pending,e=>{e.loading=!0,e.error=null}).addCase(o.fulfilled,(e,a)=>{e.loading=!1,e.saccoGroups=a.payload}).addCase(o.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(l.pending,e=>{e.loading=!0,e.error=null}).addCase(l.fulfilled,(e,a)=>{e.loading=!1,e.transactions=a.payload}).addCase(l.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(d.pending,e=>{e.loading=!0,e.error=null}).addCase(d.fulfilled,(e,a)=>{e.loading=!1,e.stats=a.payload}).addCase(d.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(i.fulfilled,(e,a)=>{var t;let r=e.users.findIndex(e=>e.id===a.payload.id);-1!==r&&(e.users[r]=a.payload),(null==(t=e.selectedUser)?void 0:t.id)===a.payload.id&&(e.selectedUser=a.payload)}).addCase(c.fulfilled,(e,a)=>{var t;let r=e.saccoGroups.findIndex(e=>e.id===a.payload.id);-1!==r&&(e.saccoGroups[r]=a.payload),(null==(t=e.selectedSaccoGroup)?void 0:t.id)===a.payload.id&&(e.selectedSaccoGroup=a.payload)}).addCase(u.fulfilled,(e,a)=>{var t;let r=e.users.findIndex(e=>e.id===a.payload.id);-1!==r&&(e.users[r]=a.payload),(null==(t=e.selectedUser)?void 0:t.id)===a.payload.id&&(e.selectedUser=a.payload)})}}),{clearError:f,setSelectedUser:g,setSelectedSaccoGroup:y,clearSelectedUser:h,clearSelectedSaccoGroup:m}=p.actions,_=p.reducer},9951:(e,a,t)=>{Promise.resolve().then(t.t.bind(t,347,23)),Promise.resolve().then(t.bind(t,1319)),Promise.resolve().then(t.bind(t,2957))}},e=>{e.O(0,[7690,9268,3415,9641,5647,4536,3568,470,7316,8441,5964,7358],()=>e(e.s=9951)),_N_E=e.O()}]);