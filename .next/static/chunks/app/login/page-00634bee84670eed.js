(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4520],{2045:(e,t,a)=>{"use strict";a.d(t,{G:()=>l,j:()=>s});var r=a(3415);let s=()=>(0,r.wA)(),l=r.d4},2099:(e,t,a)=>{"use strict";a.d(t,{ND:()=>n});var r=a(5647);a(9509);let s="https://zvelgxclmqgohntjimyf.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2ZWxneGNsbXFnb2hudGppbXlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyOTkzMDUsImV4cCI6MjA2NDg3NTMwNX0.CFdW-XH8y7hkOm7LUtqQxs36hPTRBYtha4EIeRhIXto";if(!s||!l)throw Error("Missing Supabase environment variables");let n=(0,r.UU)(s,l,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{fetch:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,{...t,signal:AbortSignal.timeout(3e4)})}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}})},9519:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>h,DY:()=>n,Lx:()=>l,y4:()=>o,z:()=>i});var r=a(4536),s=a(2099);let l=(0,r.zD)("auth/loginUser",async(e,t)=>{let{email:a,password:r}=e,{rejectWithValue:l}=t;try{var n;let{data:e,error:t}=await s.ND.auth.signInWithPassword({email:a,password:r});if(t)throw t;let{data:l,error:o}=await s.ND.from("users").select("*").eq("id",e.user.id).single();if(o)throw o;return{user:{id:l.id,email:l.email,name:"".concat(l.first_name," ").concat(l.last_name),phone:l.phone,role:l.role,bitnobWalletId:l.bitnob_wallet_id,kycStatus:l.kyc_status,created_at:l.created_at},token:(null==(n=e.session)?void 0:n.access_token)||""}}catch(e){return l(e.message)}}),n=(0,r.zD)("auth/registerUser",async(e,t)=>{let{email:a,password:r,firstName:s,lastName:l,phone:n}=e,{rejectWithValue:o}=t;try{let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(s," ").concat(l),email:a,phone:n,password:r})}),t=await e.json();if(!e.ok)throw Error(t.message);return{user:t.user,token:t.token||""}}catch(e){return o(e.message)}}),o=(0,r.zD)("auth/logoutUser",async()=>{await s.ND.auth.signOut()}),i=(0,r.zD)("auth/checkAuthStatus",async(e,t)=>{let{rejectWithValue:a}=t;try{let{data:{session:e}}=await s.ND.auth.getSession();if(!e)throw Error("No session found");let{data:t,error:a}=await s.ND.from("users").select("*").eq("id",e.user.id).single();if(a)throw a;return{user:{id:t.id,email:t.email,name:"".concat(t.first_name," ").concat(t.last_name),phone:t.phone,role:t.role,bitnobWalletId:t.bitnob_wallet_id,kycStatus:t.kyc_status,created_at:t.created_at},token:e.access_token}}catch(e){return a(e.message)}}),d=(0,r.Z0)({name:"auth",initialState:{user:null,token:null,isAuthenticated:!1,loading:!1,error:null},reducers:{clearError:e=>{e.error=null},updateUser:(e,t)=>{e.user&&(e.user={...e.user,...t.payload})}},extraReducers:e=>{e.addCase(l.pending,e=>{e.loading=!0,e.error=null}).addCase(l.fulfilled,(e,t)=>{e.loading=!1,e.user=t.payload.user,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(l.rejected,(e,t)=>{e.loading=!1,e.user=null,e.token=null,e.isAuthenticated=!1,e.error=t.payload}),e.addCase(n.pending,e=>{e.loading=!0,e.error=null}).addCase(n.fulfilled,(e,t)=>{e.loading=!1,e.user=t.payload.user,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(n.rejected,(e,t)=>{e.loading=!1,e.user=null,e.token=null,e.isAuthenticated=!1,e.error=t.payload}),e.addCase(o.fulfilled,e=>{e.user=null,e.token=null,e.isAuthenticated=!1,e.loading=!1,e.error=null}),e.addCase(i.pending,e=>{e.loading=!0}).addCase(i.fulfilled,(e,t)=>{e.loading=!1,e.user=t.payload.user,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(i.rejected,e=>{e.loading=!1,e.user=null,e.token=null,e.isAuthenticated=!1})}}),{clearError:u,updateUser:c}=d.actions,h=d.reducer},9690:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var r=a(5155),s=a(2115),l=a(6874),n=a.n(l),o=a(5695),i=a(2045),d=a(9519),u=a(3568);function c(){let[e,t]=(0,s.useState)(""),[a,l]=(0,s.useState)(""),[c,h]=(0,s.useState)(!1),m=(0,i.j)(),g=(0,o.useRouter)(),{loading:p,error:f}=(0,i.G)(e=>e.auth),y=async t=>{if(t.preventDefault(),!e||!a)return void u.Ay.error("Please fill in all fields");h(!0);try{let t=await m((0,d.Lx)({email:e,password:a}));if(d.Lx.fulfilled.match(t)){u.Ay.success("Login successful!"),console.log("Login result:",t.payload);let e=t.payload.user.role;console.log("User role:",e),"admin"===e||"super_admin"===e?(console.log("Redirecting to /admin"),g.push("/admin")):(console.log("Redirecting to /dashboard"),g.push("/dashboard"))}else console.log("Login failed:",t.payload),u.Ay.error(t.payload||"Login failed")}catch(e){console.error("Login error:",e),u.Ay.error("Login failed. Please try again.")}finally{h(!1)}};return(0,r.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center p-4",children:(0,r.jsx)("div",{className:"w-full max-w-md",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl p-8",children:[(0,r.jsxs)("div",{className:"text-center mb-8",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Village SACCO"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2",children:"Sign in to your account"})]}),(0,r.jsxs)("form",{onSubmit:y,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),(0,r.jsx)("input",{id:"email",type:"email",value:e,onChange:e=>t(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your email",required:!0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),(0,r.jsx)("input",{id:"password",type:"password",value:a,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter your password",required:!0})]}),f&&(0,r.jsx)("div",{className:"text-red-600 text-sm text-center",children:f}),(0,r.jsx)("button",{type:"submit",disabled:c||p,className:"w-full py-2 px-4 rounded-md text-white font-medium ".concat(c||p?"bg-gray-400 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500"),children:c||p?"Signing in...":"Sign In"})]}),(0,r.jsx)("div",{className:"text-center mt-6",children:(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",(0,r.jsx)(n(),{href:"/signup",className:"text-blue-600 hover:text-blue-700 font-medium",children:"Sign up"})]})})]})})})}},9905:(e,t,a)=>{Promise.resolve().then(a.bind(a,9690))}},e=>{e.O(0,[3415,9641,5647,4536,3568,7244,8441,5964,7358],()=>e(e.s=9905)),_N_E=e.O()}]);