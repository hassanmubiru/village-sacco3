(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5602],{2045:(e,t,s)=>{"use strict";s.d(t,{G:()=>d,j:()=>r});var a=s(3415);let r=()=>(0,a.wA)(),d=a.d4},2099:(e,t,s)=>{"use strict";s.d(t,{ND:()=>l});var a=s(5647);s(9509);let r="https://zvelgxclmqgohntjimyf.supabase.co",d="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2ZWxneGNsbXFnb2hudGppbXlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyOTkzMDUsImV4cCI6MjA2NDg3NTMwNX0.CFdW-XH8y7hkOm7LUtqQxs36hPTRBYtha4EIeRhIXto";if(!r||!d)throw Error("Missing Supabase environment variables");let l=(0,a.UU)(r,d,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{fetch:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,{...t,signal:AbortSignal.timeout(3e4)})}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}})},6785:(e,t,s)=>{Promise.resolve().then(s.bind(s,7540))},7540:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var a=s(5155),r=s(2115),d=s(2045),l=s(9710);function i(){let e=(0,d.j)(),{user:t}=(0,d.G)(e=>e.auth),{users:s,saccoGroups:i,transactions:c,stats:n,loading:o,error:x}=(0,d.G)(e=>e.admin),[m,p]=(0,r.useState)("overview");if((0,r.useEffect)(()=>{((null==t?void 0:t.role)==="admin"||(null==t?void 0:t.role)==="super_admin")&&(e((0,l.JG)()),e((0,l.Ym)()),e((0,l.xi)()),e((0,l.pF)()))},[e,t]),!t||"admin"!==t.role&&"super_admin"!==t.role)return(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,a.jsxs)("div",{className:"bg-white p-8 rounded-lg shadow-md",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-gray-600",children:"You don't have permission to access the admin dashboard."})]})});let u=(t,s)=>{e((0,l.rU)({userId:t,approved:s}))};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"py-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Admin Dashboard"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Manage users, SACCO groups, and monitor system activity"})]})})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsx)("div",{className:"border-b border-gray-200 mb-8",children:(0,a.jsx)("nav",{className:"-mb-px flex space-x-8",children:[{key:"overview",label:"Overview"},{key:"users",label:"Users"},{key:"groups",label:"SACCO Groups"},{key:"transactions",label:"Transactions"}].map(e=>(0,a.jsx)("button",{onClick:()=>p(e.key),className:"py-2 px-1 border-b-2 font-medium text-sm ".concat(m===e.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:e.label},e.key))})}),o&&(0,a.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),x&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 mb-6",children:(0,a.jsx)("div",{className:"flex",children:(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),(0,a.jsx)("div",{className:"mt-2 text-sm text-red-700",children:x})]})})}),!o&&(0,a.jsxs)(a.Fragment,{children:["overview"===m&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Total Users"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-blue-600",children:(null==n?void 0:n.totalUsers)||0}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[(null==n?void 0:n.activeUsers)||0," active"]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"SACCO Groups"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-green-600",children:(null==n?void 0:n.totalSaccoGroups)||0}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[(null==n?void 0:n.activeSaccoGroups)||0," active"]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Total Transactions"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-purple-600",children:(null==n?void 0:n.totalTransactions)||0})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Total Volume"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-orange-600",children:new Intl.NumberFormat("en-UG",{style:"currency",currency:"UGX"}).format((null==n?void 0:n.totalVolume)||0)})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-700 mb-2",children:"Pending KYC"}),(0,a.jsx)("p",{className:"text-3xl font-bold text-red-600",children:(null==n?void 0:n.pendingKycCount)||0}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Requires approval"})]})]}),"users"===m&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Users Management"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"KYC Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(t=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[t.first_name," ",t.last_name]}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:t.phone})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.email}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("admin"===t.role||"super_admin"===t.role?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"),children:t.role})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("approved"===t.kyc_status?"bg-green-100 text-green-800":"pending"===t.kyc_status?"bg-yellow-100 text-yellow-800":"rejected"===t.kyc_status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:t.kyc_status})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.is_active?"Active":"Inactive"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{var s,a;return s=t.id,a=t.is_active,void e((0,l.pU)({userId:s,updates:{is_active:!a}}))},className:"px-3 py-1 rounded text-xs font-medium ".concat(t.is_active?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:t.is_active?"Deactivate":"Activate"}),"pending"===t.kyc_status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>u(t.id,!0),className:"px-3 py-1 bg-green-100 text-green-700 hover:bg-green-200 rounded text-xs font-medium",children:"Approve KYC"}),(0,a.jsx)("button",{onClick:()=>u(t.id,!1),className:"px-3 py-1 bg-red-100 text-red-700 hover:bg-red-200 rounded text-xs font-medium",children:"Reject KYC"})]})]})})]},t.id))})]})})]}),"groups"===m&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"SACCO Groups Management"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Group Name"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Members"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contribution"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(t=>(0,a.jsxs)("tr",{children:[(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:t.name}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:t.description})]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[t.current_members," / ",t.max_members]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[new Intl.NumberFormat("en-UG",{style:"currency",currency:"UGX"}).format(t.contribution_amount)," / ",t.contribution_frequency]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat(t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.is_active?"Active":"Inactive"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsx)("button",{onClick:()=>{var s,a;return s=t.id,a=t.is_active,void e((0,l.au)({groupId:s,updates:{is_active:!a}}))},className:"px-3 py-1 rounded text-xs font-medium ".concat(t.is_active?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:t.is_active?"Deactivate":"Activate"})})]},t.id))})]})})]}),"transactions"===m&&(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Recent Transactions"})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Method"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Date"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("deposit"===e.type?"bg-green-100 text-green-800":"withdrawal"===e.type?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:e.type})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Intl.NumberFormat("en-UG",{style:"currency",currency:e.currency}).format(e.amount)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("completed"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"failed"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.status})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.payment_method}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString()})]},e.id))})]})})]})]})]})]})}},9710:(e,t,s)=>{"use strict";s.d(t,{Ay:()=>f,JG:()=>c,Ym:()=>d,au:()=>o,pF:()=>i,pU:()=>n,rU:()=>x,xi:()=>l});var a=s(4536),r=s(2099);let d=(0,a.zD)("admin/fetchAllUsers",async(e,t)=>{let{rejectWithValue:s}=t;try{let{data:e,error:t}=await r.ND.from("users").select("*").order("created_at",{ascending:!1});if(t)throw t;return e}catch(e){return s(e.message)}}),l=(0,a.zD)("admin/fetchAllSaccoGroups",async(e,t)=>{let{rejectWithValue:s}=t;try{let{data:e,error:t}=await r.ND.from("sacco_groups").select("*").order("created_at",{ascending:!1});if(t)throw t;return e}catch(e){return s(e.message)}}),i=(0,a.zD)("admin/fetchAllTransactions",async(e,t)=>{let{rejectWithValue:s}=t;try{let{data:e,error:t}=await r.ND.from("transactions").select("*").order("created_at",{ascending:!1}).limit(100);if(t)throw t;return e}catch(e){return s(e.message)}}),c=(0,a.zD)("admin/fetchAdminStats",async(e,t)=>{let{rejectWithValue:s}=t;try{let{count:e}=await r.ND.from("users").select("*",{count:"exact",head:!0}),{count:t}=await r.ND.from("users").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:s}=await r.ND.from("sacco_groups").select("*",{count:"exact",head:!0}),{count:a}=await r.ND.from("sacco_groups").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:d}=await r.ND.from("transactions").select("*",{count:"exact",head:!0}),{data:l}=await r.ND.from("transactions").select("amount").eq("status","completed"),i=(null==l?void 0:l.reduce((e,t)=>e+t.amount,0))||0,{count:c}=await r.ND.from("users").select("*",{count:"exact",head:!0}).eq("kyc_status","pending");return{totalUsers:e||0,activeUsers:t||0,totalSaccoGroups:s||0,activeSaccoGroups:a||0,totalTransactions:d||0,totalVolume:i,pendingKycCount:c||0}}catch(e){return s(e.message)}}),n=(0,a.zD)("admin/updateUserStatus",async(e,t)=>{let{userId:s,updates:a}=e,{rejectWithValue:d}=t;try{let{data:e,error:t}=await r.ND.from("users").update(a).eq("id",s).select().single();if(t)throw t;return e}catch(e){return d(e.message)}}),o=(0,a.zD)("admin/updateSaccoGroupStatus",async(e,t)=>{let{groupId:s,updates:a}=e,{rejectWithValue:d}=t;try{let{data:e,error:t}=await r.ND.from("sacco_groups").update(a).eq("id",s).select().single();if(t)throw t;return e}catch(e){return d(e.message)}}),x=(0,a.zD)("admin/approveKyc",async(e,t)=>{let{userId:s,approved:a}=e,{rejectWithValue:d}=t;try{let{data:e,error:t}=await r.ND.from("users").update({kyc_status:a?"approved":"rejected"}).eq("id",s).select().single();if(t)throw t;return e}catch(e){return d(e.message)}}),m=(0,a.Z0)({name:"admin",initialState:{users:[],saccoGroups:[],transactions:[],stats:null,loading:!1,error:null,selectedUser:null,selectedSaccoGroup:null},reducers:{clearError:e=>{e.error=null},setSelectedUser:(e,t)=>{e.selectedUser=t.payload},setSelectedSaccoGroup:(e,t)=>{e.selectedSaccoGroup=t.payload},clearSelectedUser:e=>{e.selectedUser=null},clearSelectedSaccoGroup:e=>{e.selectedSaccoGroup=null}},extraReducers:e=>{e.addCase(d.pending,e=>{e.loading=!0,e.error=null}).addCase(d.fulfilled,(e,t)=>{e.loading=!1,e.users=t.payload}).addCase(d.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(l.pending,e=>{e.loading=!0,e.error=null}).addCase(l.fulfilled,(e,t)=>{e.loading=!1,e.saccoGroups=t.payload}).addCase(l.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(i.pending,e=>{e.loading=!0,e.error=null}).addCase(i.fulfilled,(e,t)=>{e.loading=!1,e.transactions=t.payload}).addCase(i.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(c.pending,e=>{e.loading=!0,e.error=null}).addCase(c.fulfilled,(e,t)=>{e.loading=!1,e.stats=t.payload}).addCase(c.rejected,(e,t)=>{e.loading=!1,e.error=t.payload}).addCase(n.fulfilled,(e,t)=>{var s;let a=e.users.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.users[a]=t.payload),(null==(s=e.selectedUser)?void 0:s.id)===t.payload.id&&(e.selectedUser=t.payload)}).addCase(o.fulfilled,(e,t)=>{var s;let a=e.saccoGroups.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.saccoGroups[a]=t.payload),(null==(s=e.selectedSaccoGroup)?void 0:s.id)===t.payload.id&&(e.selectedSaccoGroup=t.payload)}).addCase(x.fulfilled,(e,t)=>{var s;let a=e.users.findIndex(e=>e.id===t.payload.id);-1!==a&&(e.users[a]=t.payload),(null==(s=e.selectedUser)?void 0:s.id)===t.payload.id&&(e.selectedUser=t.payload)})}}),{clearError:p,setSelectedUser:u,setSelectedSaccoGroup:h,clearSelectedUser:g,clearSelectedSaccoGroup:y}=m.actions,f=m.reducer}},e=>{e.O(0,[3415,9641,5647,4536,8441,5964,7358],()=>e(e.s=6785)),_N_E=e.O()}]);