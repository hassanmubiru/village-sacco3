(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9305],{984:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var s=a(5155),n=a(2115),r=a(2045),l=a(5695),i=a(6874),o=a.n(i),d=a(9519);function c(){let{user:e,isAuthenticated:t}=(0,r.G)(e=>e.auth),a=(0,r.j)(),n=(0,l.useRouter)(),i=async()=>{await a((0,d.y4)()),n.push("/login")};return t?(0,s.jsx)("nav",{className:"bg-blue-200 text-white shadow-lg",children:(0,s.jsx)("div",{className:"container mx-auto px-4",children:(0,s.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,s.jsx)(o(),{href:"/dashboard",className:"text-xl font-bold",children:"Village SACCO"}),(0,s.jsxs)("div",{className:"hidden md:flex space-x-6",children:[(0,s.jsx)(o(),{href:"/dashboard",className:"hover:text-blue-500 transition-colors",children:"Dashboard"}),(0,s.jsx)(o(),{href:"/sacco",className:"hover:text-blue-500 transition-colors",children:"SACCO Groups"}),(0,s.jsx)(o(),{href:"/transactions",className:"hover:text-blue-500 transition-colors",children:"Transactions"}),(0,s.jsx)(o(),{href:"/wallet",className:"hover:text-blue-500 transition-colors",children:"Wallet"}),((null==e?void 0:e.role)==="admin"||(null==e?void 0:e.role)==="super_admin")&&(0,s.jsx)(o(),{href:"/admin",className:"hover:text-blue-500 transition-colors bg-blue-700 px-3 py-1 rounded",children:"Admin"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("span",{className:"text-sm",children:["Welcome, ",null==e?void 0:e.name]}),(0,s.jsx)("button",{onClick:i,className:"bg-blue-700 hover:bg-blue-800 px-3 py-1 rounded text-sm transition-colors",children:"Logout"})]})]})})}):null}function u(e){let{size:t="md",message:a="Loading...",fullScreen:n=!1}=e,r=(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full border-b-2 border-blue-600 mx-auto ".concat({sm:"h-6 w-6",md:"h-12 w-12",lg:"h-16 w-16"}[t])}),a&&(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:a})]});return n?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r}):r}function h(e){let{children:t}=e,{isAuthenticated:a,loading:i}=(0,r.G)(e=>e.auth),o=(0,l.useRouter)(),[d,h]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{h(!0)},[]),(0,n.useEffect)(()=>{!d||i||a||o.push("/login")},[a,i,o,d]),d)?i?(0,s.jsx)(u,{fullScreen:!0,message:"Checking authentication..."}):a?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(c,{}),(0,s.jsx)("main",{className:"container mx-auto px-4 py-8",children:t})]}):(0,s.jsx)(u,{fullScreen:!0,message:"Redirecting to login..."}):(0,s.jsx)(u,{fullScreen:!0,message:"Loading..."})}},2045:(e,t,a)=>{"use strict";a.d(t,{G:()=>r,j:()=>n});var s=a(3415);let n=()=>(0,s.wA)(),r=s.d4},2099:(e,t,a)=>{"use strict";a.d(t,{ND:()=>l});var s=a(5647);a(9509);let n="https://zvelgxclmqgohntjimyf.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2ZWxneGNsbXFnb2hudGppbXlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyOTkzMDUsImV4cCI6MjA2NDg3NTMwNX0.CFdW-XH8y7hkOm7LUtqQxs36hPTRBYtha4EIeRhIXto";if(!n||!r)throw Error("Missing Supabase environment variables");let l=(0,s.UU)(n,r,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{fetch:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,{...t,signal:AbortSignal.timeout(3e4)})}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}})},5338:(e,t,a)=>{Promise.resolve().then(a.bind(a,984))},9519:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>h,DY:()=>l,Lx:()=>r,y4:()=>i,z:()=>o});var s=a(4536),n=a(2099);let r=(0,s.zD)("auth/loginUser",async(e,t)=>{let{email:a,password:s}=e,{rejectWithValue:r}=t;try{var l;let{data:e,error:t}=await n.ND.auth.signInWithPassword({email:a,password:s});if(t)throw t;let{data:r,error:i}=await n.ND.from("users").select("*").eq("id",e.user.id).single();if(i)throw i;return{user:{id:r.id,email:r.email,name:"".concat(r.first_name," ").concat(r.last_name),phone:r.phone,role:r.role,bitnobWalletId:r.bitnob_wallet_id,kycStatus:r.kyc_status,created_at:r.created_at},token:(null==(l=e.session)?void 0:l.access_token)||""}}catch(e){return r(e.message)}}),l=(0,s.zD)("auth/registerUser",async(e,t)=>{let{email:a,password:s,firstName:n,lastName:r,phone:l}=e,{rejectWithValue:i}=t;try{let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(n," ").concat(r),email:a,phone:l,password:s})}),t=await e.json();if(!e.ok)throw Error(t.message);return{user:t.user,token:t.token||""}}catch(e){return i(e.message)}}),i=(0,s.zD)("auth/logoutUser",async()=>{await n.ND.auth.signOut()}),o=(0,s.zD)("auth/checkAuthStatus",async(e,t)=>{let{rejectWithValue:a}=t;try{let{data:{session:e}}=await n.ND.auth.getSession();if(!e)throw Error("No session found");let{data:t,error:a}=await n.ND.from("users").select("*").eq("id",e.user.id).single();if(a)throw a;return{user:{id:t.id,email:t.email,name:"".concat(t.first_name," ").concat(t.last_name),phone:t.phone,role:t.role,bitnobWalletId:t.bitnob_wallet_id,kycStatus:t.kyc_status,created_at:t.created_at},token:e.access_token}}catch(e){return a(e.message)}}),d=(0,s.Z0)({name:"auth",initialState:{user:null,token:null,isAuthenticated:!1,loading:!1,error:null},reducers:{clearError:e=>{e.error=null},updateUser:(e,t)=>{e.user&&(e.user={...e.user,...t.payload})}},extraReducers:e=>{e.addCase(r.pending,e=>{e.loading=!0,e.error=null}).addCase(r.fulfilled,(e,t)=>{e.loading=!1,e.user=t.payload.user,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(r.rejected,(e,t)=>{e.loading=!1,e.user=null,e.token=null,e.isAuthenticated=!1,e.error=t.payload}),e.addCase(l.pending,e=>{e.loading=!0,e.error=null}).addCase(l.fulfilled,(e,t)=>{e.loading=!1,e.user=t.payload.user,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(l.rejected,(e,t)=>{e.loading=!1,e.user=null,e.token=null,e.isAuthenticated=!1,e.error=t.payload}),e.addCase(i.fulfilled,e=>{e.user=null,e.token=null,e.isAuthenticated=!1,e.loading=!1,e.error=null}),e.addCase(o.pending,e=>{e.loading=!0}).addCase(o.fulfilled,(e,t)=>{e.loading=!1,e.user=t.payload.user,e.token=t.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(o.rejected,e=>{e.loading=!1,e.user=null,e.token=null,e.isAuthenticated=!1})}}),{clearError:c,updateUser:u}=d.actions,h=d.reducer}},e=>{e.O(0,[3415,9641,5647,4536,7244,8441,5964,7358],()=>e(e.s=5338)),_N_E=e.O()}]);