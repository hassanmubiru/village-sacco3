(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{66:(e,a,t)=>{"use strict";t.d(a,{ReduxProvider:()=>ee});var r=t(5155),n=t(2115),s=t(3415),o=t(4536),i=t(9519);let c=(0,o.Z0)({name:"sacco",initialState:{groups:[],currentGroup:null,loading:!1},reducers:{setGroups:(e,a)=>{e.groups=a.payload},setCurrentGroup:(e,a)=>{e.currentGroup=a.payload},setLoading:(e,a)=>{e.loading=a.payload}}}),{setGroups:l,setCurrentGroup:d,setLoading:u}=c.actions,g=c.reducer;class m{static getInstance(){return m.instance||(m.instance=new m),m.instance}async createLightningInvoice(e,a){let t={id:"ln_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),amount:e,status:"pending",invoice:"lnbc".concat(e,"n1p").concat(Math.random().toString(36).substr(2,20)),timestamp:new Date().toISOString()};return this.lightningPayments.push(t),setTimeout(()=>{t.status=Math.random()>.1?"completed":"failed"},2e3),t}async sendLightningPayment(e,a){let t={id:"ln_pay_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),amount:a,status:"pending",timestamp:new Date().toISOString()};return this.lightningPayments.push(t),setTimeout(()=>{t.status=Math.random()>.15?"completed":"failed"},3e3),t}async getLightningPayments(){return this.lightningPayments}async initiateCrossBorderTransfer(e,a,t){let r={id:"cb_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),amount:e,currency:a,recipientCountry:t,status:"processing",exchangeRate:{USD:1,NGN:750,KES:130,GHS:12,EUR:.85,GBP:.75}[a]||1,timestamp:new Date().toISOString()};return this.crossBorderTransfers.push(r),setTimeout(()=>{r.status=Math.random()>.05?"completed":"failed"},5e3*Math.random()+5e3),r}async getCrossBorderTransfers(){return this.crossBorderTransfers}async createVirtualCard(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"visa",a={id:"card_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),cardNumber:this.generateCardNumber(e),expiryDate:this.generateExpiryDate(),status:"active",balance:0,type:e};return this.virtualCards.push(a),a}async fundVirtualCard(e,a){let t=this.virtualCards.find(a=>a.id===e);return!!t&&(t.balance+=a,!0)}async getVirtualCards(){return this.virtualCards}async freezeVirtualCard(e){let a=this.virtualCards.find(a=>a.id===e);return!!a&&(a.status="blocked",!0)}async buyUSDT(e){let a={id:"usdt_buy_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),amount:e,type:"buy",status:"pending",rate:1+(Math.random()-.5)*.02,timestamp:new Date().toISOString()};return this.usdtOperations.push(a),setTimeout(()=>{a.status=Math.random()>.05?"completed":"failed"},2e3),a}async sellUSDT(e){let a={id:"usdt_sell_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),amount:e,type:"sell",status:"pending",rate:1+(Math.random()-.5)*.02,timestamp:new Date().toISOString()};return this.usdtOperations.push(a),setTimeout(()=>{a.status=Math.random()>.05?"completed":"failed"},2e3),a}async transferUSDT(e,a){let t={id:"usdt_transfer_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),amount:e,type:"transfer",status:"pending",rate:1,timestamp:new Date().toISOString()};return this.usdtOperations.push(t),setTimeout(()=>{t.status=Math.random()>.1?"completed":"failed"},1500),t}async getUSDTOperations(){return this.usdtOperations}generateCardNumber(e){let a="visa"===e?"4":"5";for(let e=1;e<16;e++)a+=Math.floor(10*Math.random());return a.replace(/(.{4})/g,"$1 ").trim()}generateExpiryDate(){let e=new Date,a=new Date(e.getFullYear()+3,e.getMonth()+Math.floor(12*Math.random()));return"".concat((a.getMonth()+1).toString().padStart(2,"0"),"/").concat(a.getFullYear().toString().substr(2))}async clearAllMockData(){this.lightningPayments=[],this.crossBorderTransfers=[],this.virtualCards=[],this.usdtOperations=[]}async generateTestData(){await this.createLightningInvoice(5e4,"Test Invoice 1"),await this.createLightningInvoice(25e3,"Test Invoice 2"),await this.initiateCrossBorderTransfer(100,"NGN","Nigeria"),await this.initiateCrossBorderTransfer(50,"KES","Kenya"),await this.createVirtualCard("visa"),await this.createVirtualCard("mastercard"),await this.buyUSDT(100),await this.sellUSDT(50)}constructor(){this.lightningPayments=[],this.crossBorderTransfers=[],this.virtualCards=[],this.usdtOperations=[]}}var h=t(9641).Buffer,f=t(9509);class y{generateSignature(e,a,r,n){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=t(8777),i="".concat(e).concat(a).concat(r).concat(n).concat(s);return o.createHmac("sha256",this.config.secretKey).update(i).digest("hex")}async makeRequest(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",r=arguments.length>2?arguments[2]:void 0;try{let n=t(8777),s=Date.now().toString(),o=n.randomBytes(16).toString("hex"),i=r?JSON.stringify(r):"",c=this.generateSignature(a,e,s,o,i),l=new AbortController,d=setTimeout(()=>l.abort(),1e4),u=await fetch("".concat(this.baseURL).concat(e),{method:a,headers:{"Content-Type":"application/json",Accept:"application/json","x-auth-timestamp":s,"x-auth-nonce":o,"x-auth-signature":c},body:r?JSON.stringify(r):void 0,signal:l.signal});if(clearTimeout(d),!u.ok){let e=await u.json().catch(()=>({}));throw Error("Bitnob API Error: ".concat(u.status," - ").concat(e.message||u.statusText))}return await u.json()}catch(e){if(console.error("Bitnob Service Error:",e),e instanceof Error){if(e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("fetch failed"))throw Error("Bitnob service is currently unavailable. Please try again later.");if("AbortError"===e.name)throw Error("Bitnob service request timed out. Please try again.")}throw e}}async isServiceAvailable(){try{if(!this.config.secretKey)return console.warn("Bitnob credentials not configured"),!1;let e=await this.makeRequest("/wallets");return e&&(200===e.statusCode||"success"===e.status)}catch(e){if(console.error("Bitnob service availability check failed:",e),e instanceof Error&&(e.message.includes("401")||e.message.includes("403")))return console.warn("Bitnob credentials may be invalid, but service is available"),!0;return!1}}async getAvailableFeatures(){return{wallets:!0,transactions:!0,lightning:!1,crossBorder:!1,virtualCards:!1,stablecoins:!1,message:"Bitnob sandbox currently supports wallet management and transaction history only. Lightning and other advanced features may be available in production."}}async testEndpoints(){let e={};for(let a of["/health","/ping","/wallets","/lightning/invoice","/lightning/send","/bitcoin/send","/rates"])try{let r=t(8777),n=Date.now().toString(),s=r.randomBytes(16).toString("hex"),o=this.generateSignature("GET",a,n,s),i=await fetch("".concat(this.baseURL).concat(a),{method:"GET",headers:{"x-auth-timestamp":n,"x-auth-nonce":s,"x-auth-signature":o,"Content-Type":"application/json"}});e[a]=404!==i.status}catch(t){e[a]=!1}return e}async createWallet(e){try{return(await this.makeRequest("/wallets","POST",{phoneNumber:e.phoneNumber,email:e.email,firstName:e.firstName,lastName:e.lastName,dateOfBirth:e.dateOfBirth,address:e.address})).data}catch(e){throw console.error("Bitnob wallet creation error:",e),Error("Wallet creation failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async getWalletDetails(e){try{return(await this.makeRequest("/wallets/".concat(e))).data}catch(e){throw Error("Failed to get wallet details: ".concat(e instanceof Error?e.message:"Unknown error"))}}async getWalletBalance(e){try{return(await this.makeRequest("/wallets/".concat(e,"/balance"))).data}catch(e){throw Error("Balance inquiry failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async sendLightningPayment(e){try{if("sandbox"===this.config.environment){console.log("\uD83C\uDF29️ Using mock Lightning service in sandbox mode");let a=await this.mockServices.sendLightningPayment("lnbc".concat(e.amount),e.amount);return{success:!0,data:a,message:"Lightning payment initiated (mock service)"}}return(await this.makeRequest("/lightning/send","POST",e)).data}catch(e){throw console.error("Lightning payment error:",e),e}}async createLightningInvoice(e){try{if("sandbox"===this.config.environment){console.log("⚡ Using mock Lightning invoice service in sandbox mode");let a=await this.mockServices.createLightningInvoice(e.amount,e.memo||"SACCO Platform Payment");return{success:!0,data:a,message:"Lightning invoice created (mock service)"}}return(await this.makeRequest("/lightning/invoice","POST",{amount:e.amount,currency:e.currency,reference:e.reference,memo:e.memo||"SACCO Platform Payment",expiresIn:e.expiresIn||3600})).data}catch(e){throw Error("Invoice creation failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async payLightningInvoice(e,a){try{if("sandbox"===this.config.environment){console.log("\uD83D\uDCB0 Using mock Lightning payment service in sandbox mode");let a=await this.mockServices.sendLightningPayment(e,0);return{success:!0,data:a,message:"Lightning invoice paid (mock service)"}}return(await this.makeRequest("/lightning/pay","POST",{invoice:e,walletId:a})).data}catch(e){throw Error("Invoice payment failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async sendBitcoin(e){try{return(await this.makeRequest("/bitcoin/send","POST",{amount:e.amount,address:e.address,reference:e.reference,narration:e.narration||"SACCO Platform Payment"})).data}catch(e){throw Error("Bitcoin transaction failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async generateBitcoinAddress(e){try{return(await this.makeRequest("/bitcoin/address/".concat(e),"POST")).data}catch(e){throw Error("Address generation failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async submitKYC(e){try{let a=new FormData;Object.entries(e).forEach(e=>{let[t,r]=e;r instanceof File?a.append(t,r):r&&a.append(t,r.toString())});let r=t(8777),n=Date.now().toString(),s=r.randomBytes(16).toString("hex"),o=this.generateSignature("POST","/kyc/submit",n,s),i=await fetch("".concat(this.baseURL,"/kyc/submit"),{method:"POST",headers:{"x-auth-timestamp":n,"x-auth-nonce":s,"x-auth-signature":o},body:a});if(!i.ok){let e=await i.json().catch(()=>({}));throw Error("KYC submission failed: ".concat(e.message||i.statusText))}return(await i.json()).data}catch(e){throw Error("KYC submission failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async getKYCStatus(e){try{return(await this.makeRequest("/kyc/status/".concat(e))).data}catch(e){throw Error("KYC status check failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async convertBTCToFiat(e){try{return(await this.makeRequest("/convert","POST",{amount:e.amount,fromCurrency:e.fromCurrency,toCurrency:e.toCurrency,reference:e.reference})).data}catch(e){throw Error("Conversion failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async getExchangeRates(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"BTC";try{return(await this.makeRequest("/rates?base=".concat(e))).data}catch(e){throw Error("Failed to get exchange rates: ".concat(e instanceof Error?e.message:"Unknown error"))}}async getTransactionHistory(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;try{return(await this.makeRequest("/transactions?walletId=".concat(e,"&limit=").concat(a,"&offset=").concat(t))).data}catch(e){throw Error("Failed to get transaction history: ".concat(e instanceof Error?e.message:"Unknown error"))}}async getTransactionDetails(e){try{return(await this.makeRequest("/transactions/".concat(e))).data}catch(e){throw Error("Failed to get transaction details: ".concat(e instanceof Error?e.message:"Unknown error"))}}verifyWebhookSignature(e,a,r){try{let n=t(8777),s=n.createHmac("sha256",r).update(e).digest("hex");return n.timingSafeEqual(h.from(a,"hex"),h.from(s,"hex"))}catch(e){return console.error("Webhook signature verification failed:",e),!1}}async sendUSDT(e){try{return(await this.makeRequest("/stablecoins/usdt/send","POST",{amount:e.amount,currency:e.currency,targetNetwork:e.targetNetwork,recipientAddress:e.recipientAddress,reference:e.reference})).data}catch(e){throw Error("USDT transfer failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async convertToUSDT(e){try{return(await this.makeRequest("/stablecoins/convert","POST",{amount:e.amount,fromCurrency:e.fromCurrency,toCurrency:"USDT",reference:e.reference})).data}catch(e){throw Error("USDT conversion failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async getCrossBorderRates(e,a,t){try{return(await this.makeRequest("/cross-border/rates?source=".concat(e,"&target=").concat(a,"&country=").concat(t))).data}catch(e){throw Error("Failed to get cross-border rates: ".concat(e instanceof Error?e.message:"Unknown error"))}}async updateCardLimit(e,a){try{return(await this.makeRequest("/virtual-cards/".concat(e,"/limit"),"PUT",{spendingLimit:a})).data}catch(e){throw Error("Failed to update card limit: ".concat(e instanceof Error?e.message:"Unknown error"))}}async sendCrossBorderPayment(e){try{if("sandbox"===this.config.environment){console.log("\uD83C\uDF0D Using mock cross-border service in sandbox mode");let a=await this.mockServices.initiateCrossBorderTransfer(e.amount,e.targetCurrency,e.recipientCountry);return{success:!0,data:a,message:"Cross-border payment initiated (mock service)"}}return(await this.makeRequest("/cross-border/send","POST",e)).data}catch(e){throw Error("Cross-border payment failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async getCrossBorderTransfers(){try{if("sandbox"===this.config.environment){console.log("\uD83D\uDCCB Using mock cross-border history in sandbox mode");let e=await this.mockServices.getCrossBorderTransfers();return{success:!0,data:e,message:"Cross-border transfers retrieved (mock service)"}}return(await this.makeRequest("/cross-border/transfers")).data}catch(e){throw Error("Failed to get cross-border transfers: ".concat(e instanceof Error?e.message:"Unknown error"))}}async createVirtualCard(e){try{if("sandbox"===this.config.environment){console.log("\uD83D\uDCB3 Using mock virtual card service in sandbox mode");let e=await this.mockServices.createVirtualCard("visa");return{success:!0,data:e,message:"Virtual card created (mock service)"}}return(await this.makeRequest("/virtual-cards","POST",e)).data}catch(e){throw Error("Virtual card creation failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async getVirtualCards(e){try{if("sandbox"===this.config.environment){console.log("\uD83D\uDDC2️ Using mock virtual card list in sandbox mode");let e=await this.mockServices.getVirtualCards();return{success:!0,data:e,message:"Virtual cards retrieved (mock service)"}}return(await this.makeRequest(e?"/virtual-cards/user/".concat(e):"/virtual-cards")).data}catch(e){throw Error("Failed to get virtual cards: ".concat(e instanceof Error?e.message:"Unknown error"))}}async fundVirtualCard(e,a){try{if("sandbox"===this.config.environment){console.log("\uD83D\uDCB0 Using mock card funding in sandbox mode");let t=await this.mockServices.fundVirtualCard(e,a);return{success:t,message:"Virtual card ".concat(t?"funded":"funding failed"," (mock service)")}}return(await this.makeRequest("/virtual-cards/".concat(e,"/fund"),"POST",{amount:a})).data}catch(e){throw Error("Failed to fund card: ".concat(e instanceof Error?e.message:"Unknown error"))}}async freezeCard(e){try{if("sandbox"===this.config.environment){console.log("\uD83E\uDDCA Using mock card freeze in sandbox mode");let a=await this.mockServices.freezeVirtualCard(e);return{success:a,message:"Virtual card ".concat(a?"frozen":"freeze failed"," (mock service)")}}return(await this.makeRequest("/virtual-cards/".concat(e,"/freeze"),"POST")).data}catch(e){throw Error("Failed to freeze card: ".concat(e instanceof Error?e.message:"Unknown error"))}}async unfreezeCard(e){try{return"sandbox"===this.config.environment&&console.log("\uD83D\uDD25 Mock card unfreeze not implemented - using production endpoint"),(await this.makeRequest("/virtual-cards/".concat(e,"/unfreeze"),"POST")).data}catch(e){throw Error("Failed to unfreeze card: ".concat(e instanceof Error?e.message:"Unknown error"))}}async buyStablecoin(e){try{if("sandbox"===this.config.environment){console.log("\uD83E\uDE99 Using mock USDT buy service in sandbox mode");let a=await this.mockServices.buyUSDT(e.amount);return{success:!0,data:a,message:"USDT purchased (mock service)"}}return(await this.makeRequest("/stablecoins/buy","POST",e)).data}catch(e){throw Error("Stablecoin purchase failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async sellStablecoin(e){try{if("sandbox"===this.config.environment){console.log("\uD83D\uDCB1 Using mock USDT sell service in sandbox mode");let a=await this.mockServices.sellUSDT(e.amount);return{success:!0,data:a,message:"USDT sold (mock service)"}}return(await this.makeRequest("/stablecoins/sell","POST",e)).data}catch(e){throw Error("Stablecoin sale failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async transferStablecoin(e){try{if("sandbox"===this.config.environment){console.log("\uD83D\uDD04 Using mock USDT transfer service in sandbox mode");let a=await this.mockServices.transferUSDT(e.amount,e.recipientAddress||"mock-recipient");return{success:!0,data:a,message:"USDT transferred (mock service)"}}return(await this.makeRequest("/stablecoins/transfer","POST",e)).data}catch(e){throw Error("Stablecoin transfer failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}async getStablecoinOperations(){try{if("sandbox"===this.config.environment){console.log("\uD83D\uDCCA Using mock USDT operations in sandbox mode");let e=await this.mockServices.getUSDTOperations();return{success:!0,data:e,message:"USDT operations retrieved (mock service)"}}return(await this.makeRequest("/stablecoins/operations")).data}catch(e){throw Error("Failed to get stablecoin operations: ".concat(e instanceof Error?e.message:"Unknown error"))}}async healthCheck(){try{return await this.makeRequest("/health")}catch(e){throw Error("Health check failed: ".concat(e instanceof Error?e.message:"Unknown error"))}}constructor(e){this.config=e,this.baseURL=e.baseURL||("production"===e.environment?"https://api.bitnob.com/api/v1":"https://sandboxapi.bitnob.com/api/v1"),this.mockServices=m.getInstance()}}let p=null,w=function(){if(p)return p;let e=f.env.BITNOB_SECRET_KEY||"",a=f.env.NEXT_PUBLIC_BITNOB_BASE_URL||f.env.BITNOB_BASE_URL||"https://sandboxapi.bitnob.com/api/v1",t={secretKey:e,environment:a.includes("sandbox")?"sandbox":"production",baseURL:a};return e||console.warn("Bitnob credentials not configured. Bitcoin wallet features will be disabled."),p=new y(t)}(),v=(0,o.zD)("wallet/createWallet",async e=>await w.createWallet(e)),b=(0,o.zD)("wallet/fetchBalance",async e=>await w.getWalletBalance(e)),S=(0,o.zD)("wallet/fetchTransactions",async e=>await w.getTransactionHistory(e)),k=(0,o.zD)("wallet/sendLightningPayment",async e=>await w.sendLightningPayment(e)),_=(0,o.zD)("wallet/createInvoice",async e=>await w.createLightningInvoice(e)),C=(0,o.zD)("wallet/getExchangeRates",async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"BTC";return await w.getExchangeRates(e)}),D=(0,o.Z0)({name:"wallet",initialState:{balance:null,transactions:[],loading:!1,error:null,walletId:null},reducers:{clearWalletError:e=>{e.error=null},setWalletId:(e,a)=>{e.walletId=a.payload},updateBalance:(e,a)=>{e.balance=a.payload},addTransaction:(e,a)=>{e.transactions.unshift(a.payload)},updateTransaction:(e,a)=>{let{id:t,updates:r}=a.payload,n=e.transactions.findIndex(e=>e.id===t);-1!==n&&(e.transactions[n]={...e.transactions[n],...r})}},extraReducers:e=>{e.addCase(v.pending,e=>{e.loading=!0,e.error=null}).addCase(v.fulfilled,(e,a)=>{e.loading=!1,e.walletId=a.payload.id,e.balance={btc:0,satoshis:0,fiat:0,currency:"UGX",lastUpdated:new Date().toISOString()}}).addCase(v.rejected,(e,a)=>{e.loading=!1,e.error=a.error.message||"Failed to create wallet"}),e.addCase(b.pending,e=>{e.loading=!0,e.error=null}).addCase(b.fulfilled,(e,a)=>{e.loading=!1,e.balance={btc:a.payload.btc||0,satoshis:a.payload.satoshis||0,fiat:a.payload.fiat||0,currency:a.payload.currency||"UGX",lastUpdated:new Date().toISOString()}}).addCase(b.rejected,(e,a)=>{e.loading=!1,e.error=a.error.message||"Failed to fetch balance"}),e.addCase(S.pending,e=>{e.loading=!0,e.error=null}).addCase(S.fulfilled,(e,a)=>{e.loading=!1,e.transactions=a.payload.transactions||[]}).addCase(S.rejected,(e,a)=>{e.loading=!1,e.error=a.error.message||"Failed to fetch transactions"}),e.addCase(k.pending,e=>{e.loading=!0,e.error=null}).addCase(k.fulfilled,(e,a)=>{e.loading=!1,a.payload.transaction&&e.transactions.unshift(a.payload.transaction)}).addCase(k.rejected,(e,a)=>{e.loading=!1,e.error=a.error.message||"Payment failed"}),e.addCase(_.pending,e=>{e.loading=!0,e.error=null}).addCase(_.fulfilled,e=>{e.loading=!1}).addCase(_.rejected,(e,a)=>{e.loading=!1,e.error=a.error.message||"Failed to create invoice"}),e.addCase(C.pending,e=>{e.loading=!0,e.error=null}).addCase(C.fulfilled,e=>{e.loading=!1}).addCase(C.rejected,(e,a)=>{e.loading=!1,e.error=a.error.message||"Failed to fetch exchange rates"})}}),{clearWalletError:U,setWalletId:T,updateBalance:E,addTransaction:x,updateTransaction:N}=D.actions,O=D.reducer,P=(0,o.Z0)({name:"transactions",initialState:{transactions:[],loading:!1},reducers:{setTransactions:(e,a)=>{e.transactions=a.payload},addTransaction:(e,a)=>{e.transactions.unshift(a.payload)},setLoading:(e,a)=>{e.loading=a.payload}}}),{setTransactions:I,addTransaction:R,setLoading:B}=P.actions,q=P.reducer;var z=t(9710),L=t(2099);let A=(0,o.zD)("governance/fetchProposals",async(e,a)=>{let{rejectWithValue:t}=a;try{let a=L.ND.from("governance_proposals").select("\n          *,\n          users!governance_proposals_proposed_by_fkey(first_name, last_name)\n        ").order("created_at",{ascending:!1});e&&(a=a.eq("sacco_group_id",e));let{data:t,error:r}=await a;if(r)throw r;return t.map(e=>({...e,proposer_name:e.users?"".concat(e.users.first_name," ").concat(e.users.last_name):"Unknown"}))}catch(e){return t(e.message)}}),j=(0,o.zD)("governance/createProposal",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:a,error:t}=await L.ND.from("governance_proposals").insert(e).select().single();if(t)throw t;return a}catch(e){return t(e.message)}}),G=(0,o.zD)("governance/castVote",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:a,error:t}=await L.ND.from("governance_votes").insert({...e,voting_weight:e.voting_weight||1}).select().single();if(t)throw t;let{error:r}=await L.ND.rpc("update_proposal_votes",{proposal_id:e.proposal_id});if(r)throw r;return a}catch(e){return t(e.message)}}),F=(0,o.zD)("governance/fetchUserVotes",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:e,error:a}=await L.ND.from("governance_votes").select("*").order("voted_at",{ascending:!1});if(a)throw a;return e}catch(e){return t(e.message)}}),M=(0,o.zD)("governance/fetchLoanDefaults",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:e,error:a}=await L.ND.from("loan_defaults").select("\n          *,\n          loans!loan_defaults_loan_id_fkey(\n            borrower_id,\n            amount,\n            users!loans_borrower_id_fkey(first_name, last_name)\n          )\n        ").order("flagged_at",{ascending:!1});if(a)throw a;return e.map(e=>({...e,loan:e.loans?{...e.loans,borrower_name:e.loans.users?"".concat(e.loans.users.first_name," ").concat(e.loans.users.last_name):"Unknown"}:null}))}catch(e){return t(e.message)}}),V=(0,o.zD)("governance/fetchTransactionHistory",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:e,error:a}=await L.ND.from("member_transaction_history").select("*").order("created_at",{ascending:!1});if(a)throw a;return e}catch(e){return t(e.message)}}),K=(0,o.zD)("governance/fetchAuditLog",async(e,a)=>{let{rejectWithValue:t}=a;try{let a=L.ND.from("audit_log").select("*").order("timestamp",{ascending:!1}).limit(100);(null==e?void 0:e.table_name)&&(a=a.eq("table_name",e.table_name)),(null==e?void 0:e.user_id)&&(a=a.eq("user_id",e.user_id));let{data:t,error:r}=await a;if(r)throw r;return t}catch(e){return t(e.message)}}),W=(0,o.zD)("governance/updateLoanDefaultStatus",async(e,a)=>{let{defaultId:t,status:r,notes:n}=e,{rejectWithValue:s}=a;try{let e={status:r};n&&(e.resolution_notes=n),"written_off"===r&&(e.resolved_at=new Date().toISOString());let{data:a,error:s}=await L.ND.from("loan_defaults").update(e).eq("id",t).select().single();if(s)throw s;return a}catch(e){return s(e.message)}}),Y=(0,o.Z0)({name:"governance",initialState:{proposals:[],userVotes:[],loanDefaults:[],transactionHistory:[],auditLog:[],loading:!1,error:null,selectedProposal:null},reducers:{clearError:e=>{e.error=null},setSelectedProposal:(e,a)=>{e.selectedProposal=a.payload},clearSelectedProposal:e=>{e.selectedProposal=null}},extraReducers:e=>{e.addCase(A.pending,e=>{e.loading=!0,e.error=null}).addCase(A.fulfilled,(e,a)=>{e.loading=!1,e.proposals=a.payload}).addCase(A.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(j.fulfilled,(e,a)=>{e.proposals.unshift(a.payload)}).addCase(G.fulfilled,(e,a)=>{e.userVotes.unshift(a.payload)}).addCase(F.fulfilled,(e,a)=>{e.userVotes=a.payload}).addCase(M.fulfilled,(e,a)=>{e.loanDefaults=a.payload}).addCase(V.fulfilled,(e,a)=>{e.transactionHistory=a.payload}).addCase(K.fulfilled,(e,a)=>{e.auditLog=a.payload}).addCase(W.fulfilled,(e,a)=>{let t=e.loanDefaults.findIndex(e=>e.id===a.payload.id);-1!==t&&(e.loanDefaults[t]=a.payload)})}}),{clearError:J,setSelectedProposal:X,clearSelectedProposal:H}=Y.actions,Z=Y.reducer,Q=(0,o.U1)({reducer:{auth:i.Ay,sacco:g,wallet:O,transactions:q,admin:z.Ay,governance:Z}});function $(e){let{children:a}=e,[t,s]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{s(!0),Q.dispatch((0,i.z)())},[]),(0,r.jsx)(r.Fragment,{children:a})}function ee(e){let{children:a}=e;return(0,r.jsx)(s.Kq,{store:Q,children:(0,r.jsx)($,{children:a})})}},347:()=>{},1319:(e,a,t)=>{"use strict";t.d(a,{default:()=>s});var r=t(5155),n=t(3568);function s(){return(0,r.jsx)(n.l$,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#1f2937",color:"#fff"},success:{iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})}},2099:(e,a,t)=>{"use strict";t.d(a,{ND:()=>o});var r=t(5647);t(9509);let n="https://zvelgxclmqgohntjimyf.supabase.co",s="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp2ZWxneGNsbXFnb2hudGppbXlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyOTkzMDUsImV4cCI6MjA2NDg3NTMwNX0.CFdW-XH8y7hkOm7LUtqQxs36hPTRBYtha4EIeRhIXto";if(!n||!s)throw Error("Missing Supabase environment variables");let o=(0,r.UU)(n,s,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{fetch:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,{...a,signal:AbortSignal.timeout(3e4)})}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}})},9519:(e,a,t)=>{"use strict";t.d(a,{Ay:()=>g,DY:()=>o,Lx:()=>s,y4:()=>i,z:()=>c});var r=t(4536),n=t(2099);let s=(0,r.zD)("auth/loginUser",async(e,a)=>{let{email:t,password:r}=e,{rejectWithValue:s}=a;try{var o;let{data:e,error:a}=await n.ND.auth.signInWithPassword({email:t,password:r});if(a)throw a;let{data:s,error:i}=await n.ND.from("users").select("*").eq("id",e.user.id).single();if(i)throw i;return{user:{id:s.id,email:s.email,first_name:s.first_name,last_name:s.last_name,phone:s.phone,bitnob_wallet_id:s.bitnob_wallet_id,kyc_status:s.kyc_status,is_active:s.is_active,created_at:s.created_at,updated_at:s.updated_at,name:"".concat(s.first_name," ").concat(s.last_name)},token:(null==(o=e.session)?void 0:o.access_token)||""}}catch(e){return s(e.message)}}),o=(0,r.zD)("auth/registerUser",async(e,a)=>{let{email:t,password:r,firstName:n,lastName:s,phone:o}=e,{rejectWithValue:i}=a;try{let e=await fetch("/api/auth/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"".concat(n," ").concat(s),email:t,phone:o,password:r})}),a=await e.json();if(!e.ok)throw Error(a.message);return{user:a.user,token:a.token||""}}catch(e){return i(e.message)}}),i=(0,r.zD)("auth/logoutUser",async()=>{await n.ND.auth.signOut()}),c=(0,r.zD)("auth/checkAuthStatus",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:{session:e}}=await n.ND.auth.getSession();if(!e)throw Error("No session found");let{data:a,error:t}=await n.ND.from("users").select("*").eq("id",e.user.id).single();if(t)throw t;return{user:{id:a.id,email:a.email,first_name:a.first_name,last_name:a.last_name,phone:a.phone,bitnob_wallet_id:a.bitnob_wallet_id,kyc_status:a.kyc_status,is_active:a.is_active,created_at:a.created_at,updated_at:a.updated_at,name:"".concat(a.first_name," ").concat(a.last_name)},token:e.access_token}}catch(e){return t(e.message)}}),l=(0,r.Z0)({name:"auth",initialState:{user:null,token:null,isAuthenticated:!1,loading:!1,error:null},reducers:{clearError:e=>{e.error=null},updateUser:(e,a)=>{e.user&&(e.user={...e.user,...a.payload})}},extraReducers:e=>{e.addCase(s.pending,e=>{e.loading=!0,e.error=null}).addCase(s.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload.user,e.token=a.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(s.rejected,(e,a)=>{e.loading=!1,e.user=null,e.token=null,e.isAuthenticated=!1,e.error=a.payload}),e.addCase(o.pending,e=>{e.loading=!0,e.error=null}).addCase(o.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload.user,e.token=a.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(o.rejected,(e,a)=>{e.loading=!1,e.user=null,e.token=null,e.isAuthenticated=!1,e.error=a.payload}),e.addCase(i.fulfilled,e=>{e.user=null,e.token=null,e.isAuthenticated=!1,e.loading=!1,e.error=null}),e.addCase(c.pending,e=>{e.loading=!0}).addCase(c.fulfilled,(e,a)=>{e.loading=!1,e.user=a.payload.user,e.token=a.payload.token,e.isAuthenticated=!0,e.error=null}).addCase(c.rejected,e=>{e.loading=!1,e.user=null,e.token=null,e.isAuthenticated=!1})}}),{clearError:d,updateUser:u}=l.actions,g=l.reducer},9710:(e,a,t)=>{"use strict";t.d(a,{Ay:()=>w,JG:()=>c,Ym:()=>s,au:()=>d,pF:()=>i,pU:()=>l,rU:()=>u,xi:()=>o});var r=t(4536),n=t(2099);let s=(0,r.zD)("admin/fetchAllUsers",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:e,error:a}=await n.ND.from("users").select("*").order("created_at",{ascending:!1});if(a)throw a;return e}catch(e){return t(e.message)}}),o=(0,r.zD)("admin/fetchAllSaccoGroups",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:e,error:a}=await n.ND.from("sacco_groups").select("*").order("created_at",{ascending:!1});if(a)throw a;return e}catch(e){return t(e.message)}}),i=(0,r.zD)("admin/fetchAllTransactions",async(e,a)=>{let{rejectWithValue:t}=a;try{let{data:e,error:a}=await n.ND.from("transactions").select("*").order("created_at",{ascending:!1}).limit(100);if(a)throw a;return e}catch(e){return t(e.message)}}),c=(0,r.zD)("admin/fetchAdminStats",async(e,a)=>{let{rejectWithValue:t}=a;try{let{count:e}=await n.ND.from("users").select("*",{count:"exact",head:!0}),{count:a}=await n.ND.from("users").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:t}=await n.ND.from("sacco_groups").select("*",{count:"exact",head:!0}),{count:r}=await n.ND.from("sacco_groups").select("*",{count:"exact",head:!0}).eq("is_active",!0),{count:s}=await n.ND.from("transactions").select("*",{count:"exact",head:!0}),{data:o}=await n.ND.from("transactions").select("amount").eq("status","completed"),i=(null==o?void 0:o.reduce((e,a)=>e+a.amount,0))||0,{count:c}=await n.ND.from("users").select("*",{count:"exact",head:!0}).eq("kyc_status","pending");return{totalUsers:e||0,activeUsers:a||0,totalSaccoGroups:t||0,activeSaccoGroups:r||0,totalTransactions:s||0,totalVolume:i,pendingKycCount:c||0}}catch(e){return t(e.message)}}),l=(0,r.zD)("admin/updateUserStatus",async(e,a)=>{let{userId:t,updates:r}=e,{rejectWithValue:s}=a;try{let{data:e,error:a}=await n.ND.from("users").update(r).eq("id",t).select().single();if(a)throw a;return e}catch(e){return s(e.message)}}),d=(0,r.zD)("admin/updateSaccoGroupStatus",async(e,a)=>{let{groupId:t,updates:r}=e,{rejectWithValue:s}=a;try{let{data:e,error:a}=await n.ND.from("sacco_groups").update(r).eq("id",t).select().single();if(a)throw a;return e}catch(e){return s(e.message)}}),u=(0,r.zD)("admin/approveKyc",async(e,a)=>{let{userId:t,approved:r}=e,{rejectWithValue:s}=a;try{let{data:e,error:a}=await n.ND.from("users").update({kyc_status:r?"approved":"rejected"}).eq("id",t).select().single();if(a)throw a;return e}catch(e){return s(e.message)}}),g=(0,r.Z0)({name:"admin",initialState:{users:[],saccoGroups:[],transactions:[],stats:null,loading:!1,error:null,selectedUser:null,selectedSaccoGroup:null},reducers:{clearError:e=>{e.error=null},setSelectedUser:(e,a)=>{e.selectedUser=a.payload},setSelectedSaccoGroup:(e,a)=>{e.selectedSaccoGroup=a.payload},clearSelectedUser:e=>{e.selectedUser=null},clearSelectedSaccoGroup:e=>{e.selectedSaccoGroup=null}},extraReducers:e=>{e.addCase(s.pending,e=>{e.loading=!0,e.error=null}).addCase(s.fulfilled,(e,a)=>{e.loading=!1,e.users=a.payload}).addCase(s.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(o.pending,e=>{e.loading=!0,e.error=null}).addCase(o.fulfilled,(e,a)=>{e.loading=!1,e.saccoGroups=a.payload}).addCase(o.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(i.pending,e=>{e.loading=!0,e.error=null}).addCase(i.fulfilled,(e,a)=>{e.loading=!1,e.transactions=a.payload}).addCase(i.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(c.pending,e=>{e.loading=!0,e.error=null}).addCase(c.fulfilled,(e,a)=>{e.loading=!1,e.stats=a.payload}).addCase(c.rejected,(e,a)=>{e.loading=!1,e.error=a.payload}).addCase(l.fulfilled,(e,a)=>{var t;let r=e.users.findIndex(e=>e.id===a.payload.id);-1!==r&&(e.users[r]=a.payload),(null==(t=e.selectedUser)?void 0:t.id)===a.payload.id&&(e.selectedUser=a.payload)}).addCase(d.fulfilled,(e,a)=>{var t;let r=e.saccoGroups.findIndex(e=>e.id===a.payload.id);-1!==r&&(e.saccoGroups[r]=a.payload),(null==(t=e.selectedSaccoGroup)?void 0:t.id)===a.payload.id&&(e.selectedSaccoGroup=a.payload)}).addCase(u.fulfilled,(e,a)=>{var t;let r=e.users.findIndex(e=>e.id===a.payload.id);-1!==r&&(e.users[r]=a.payload),(null==(t=e.selectedUser)?void 0:t.id)===a.payload.id&&(e.selectedUser=a.payload)})}}),{clearError:m,setSelectedUser:h,setSelectedSaccoGroup:f,clearSelectedUser:y,clearSelectedSaccoGroup:p}=g.actions,w=g.reducer},9951:(e,a,t)=>{Promise.resolve().then(t.t.bind(t,347,23)),Promise.resolve().then(t.bind(t,1319)),Promise.resolve().then(t.bind(t,66))}},e=>{e.O(0,[7690,9268,3415,5647,4536,3568,470,8441,5964,7358],()=>e(e.s=9951)),_N_E=e.O()}]);